ğŸ‰ RESUMEN - Scripts para NBA Stats API

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        Â¿QUÃ‰ SE HA CREADO?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Se han generado 5 mÃ³dulos Python + documentaciÃ³n completa en la carpeta:
  ğŸ“ e:\Proyectos\nba-stats-api\scripts\

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        ARCHIVOS CREADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CÃ“DIGO PYTHON:
âœ“ __init__.py                  - Inicializador del mÃ³dulo
âœ“ user_creator.py              - Crear usuarios en Supabase + BD
âœ“ subscription_assigner.py      - Asignar suscripciÃ³n 'free'
âœ“ api_key_creator.py           - Generar API keys seguras
âœ“ endpoint_tester.py           - Probar endpoints hasta lÃ­mite
âœ“ main.py                      - â­ Script orquestrador principal
âœ“ examples.py                  - Ejemplos avanzados de uso

DOCUMENTACIÃ“N:
âœ“ README.md                    - GuÃ­a completa y uso
âœ“ ARCHITECTURE.md              - Diagramas tÃ©cnicos y flujos
âœ“ TROUBLESHOOTING.md           - SoluciÃ³n de problemas
âœ“ INDEX.md                     - Ãndice de archivos
âœ“ QUICKREF.md                  - Referencia rÃ¡pida
âœ“ requirements-scripts.txt     - Dependencias

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        INICIO RÃPIDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

OPCIÃ“N 1: EjecuciÃ³n Simple
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ python scripts/main.py test@example.com

OPCIÃ“N 2: EjecuciÃ³n Avanzada
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$ python scripts/main.py test@example.com --limit-window hour --api-url http://localhost:8000/api/v1

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        QUÃ‰ HACE CADA MÃ“DULO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1ï¸âƒ£  USER CREATOR (user_creator.py)
    â”œâ”€ Crea usuario en Supabase Auth
    â”œâ”€ Registra usuario en tabla 'users'
    â””â”€ Retorna: ID, email, UUID de Supabase

2ï¸âƒ£  SUBSCRIPTION ASSIGNER (subscription_assigner.py)
    â”œâ”€ Obtiene plan 'free'
    â”œâ”€ Crea suscripciÃ³n para el usuario
    â”œâ”€ DuraciÃ³n: 30 dÃ­as
    â””â”€ LÃ­mites: 10/min, 100/hora, 1000/dÃ­a

3ï¸âƒ£  API KEY CREATOR (api_key_creator.py)
    â”œâ”€ Genera clave segura con secrets
    â”œâ”€ Hashea con Argon2
    â”œâ”€ Guarda en tabla 'api_keys'
    â””â”€ Retorna clave completa (SOLO UNA VEZ)

4ï¸âƒ£  ENDPOINT TESTER (endpoint_tester.py)
    â”œâ”€ Hace requests a /games, /players, /teams
    â”œâ”€ Monitorea lÃ­mites de rate limiting
    â”œâ”€ ContinÃºa hasta alcanzar el lÃ­mite
    â””â”€ Retorna estadÃ­sticas de requests

5ï¸âƒ£  MAIN (main.py) - ORQUESTRADOR
    â”œâ”€ Executa los 4 pasos anteriores en orden
    â”œâ”€ Maneja sesiones de BD automÃ¡ticamente
    â”œâ”€ Muestra resumen visual
    â””â”€ Retorna datos consolidados

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        FLUJO COMPLETO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ENTRADA:
  $ python scripts/main.py test@example.com --limit-window minute

PROCESO:
  [1/4] Crear Usuario
        â””â”€â–º Supabase Auth CREATE â†’ BD INSERT â†’ Usuario ID 5 creado âœ“
  
  [2/4] Asignar SuscripciÃ³n Free
        â””â”€â–º SELECT plan 'free' â†’ INSERT user_subscriptions â†’ ID 3 âœ“
  
  [3/4] Crear API Key
        â””â”€â–º Generar clave â†’ Hash Argon2 â†’ INSERT api_keys â†’ ID 7 âœ“
        â””â”€â–º Clave: bestat_nba_xK9mP2vQ7sL4nR8wE3jT1dF6hY5cV0bN
  
  [4/4] Probar Endpoints hasta LÃ­mite (10 por minuto)
        â””â”€â–º Request 1:  /games â†’ âœ“ 200 (9 restantes)
        â””â”€â–º Request 2:  /players â†’ âœ“ 200 (8 restantes)
        â””â”€â–º ...
        â””â”€â–º Request 10: /games â†’ âœ“ 200 (0 restantes)
        â””â”€â–º âœ“ LÃMITE ALCANZADO

SALIDA:
  âœ“ Flujo completado exitosamente
  âœ“ Usuario: test@example.com (ID 5)
  âœ“ SuscripciÃ³n: free
  âœ“ API Key: 7 (Ãºltimos: ...0bN)
  âœ“ Requests realizados: 10

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        CARACTERÃSTICAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ MÃ³dulos independientes - Reutilizables
âœ“ Async/await - Operaciones no bloqueantes
âœ“ Manejo de errores - Con try/except y logging
âœ“ DocumentaciÃ³n - Docstrings en todos los mÃ³dulos
âœ“ Ejemplos - CÃ³digo de ejemplo en examples.py
âœ“ ConfiguraciÃ³n - Variables de entorno desde .env
âœ“ Rate limiting - Monitorea lÃ­mites en tiempo real
âœ“ Seguridad - Hashing Argon2, sin claves en BD

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        REQUISITOS PREVIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Python 3.9+
âœ“ variables de entorno en .env:
  - DATABASE_URL (PostgreSQL)
  - SUPABASE_URL
  - SUPABASE_SERVICE_ROLE_KEY
  - REDIS_URL (opcional, para rate limiting)
âœ“ BD con tablas:
  - users
  - subscription_plans (con plan 'free')
  - user_subscriptions
  - api_keys
âœ“ API FastAPI corriendo en http://localhost:8000
âœ“ Dependencias instaladas (pip install -r requirements.txt)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        DOCUMENTACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“– PARA LEER:

1. QUICKREF.md
   â””â”€â–º Referencia rÃ¡pida (2 minutos)

2. README.md
   â””â”€â–º GuÃ­a completa de uso (10 minutos)

3. ARCHITECTURE.md
   â””â”€â–º Diagramas y flujos tÃ©cnicos (15 minutos)

4. TROUBLESHOOTING.md
   â””â”€â–º SoluciÃ³n de problemas (segÃºn sea necesario)

5. examples.py
   â””â”€â–º CÃ³digo de ejemplo para casos especÃ­ficos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        CASOS DE USO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Crear usuario de prueba
  $ python scripts/main.py testuser@example.com

âœ“ Probar hasta lÃ­mite por hora
  $ python scripts/main.py testuser@example.com --limit-window hour

âœ“ Probar hasta lÃ­mite por dÃ­a
  $ python scripts/main.py testuser@example.com --limit-window day

âœ“ Crear usuario y usar API key manualmente
  - Ejecutar main.py
  - Guardar API key retornada
  - Usar en headers: X-API-Key: bestat_nba_...

âœ“ Crear mÃºltiples usuarios
  for i in {1..5}; do
    python scripts/main.py "user$i@test.com"
  done

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        ESTRUCTURA DE BD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

users
  â”œâ”€ id (PK)
  â”œâ”€ email
  â”œâ”€ supabase_user_id
  â””â”€ role, is_active, created_at

subscription_plans
  â”œâ”€ id (PK)
  â”œâ”€ plan_name ('free', 'premium', etc)
  â”œâ”€ rate_limit_per_minute
  â”œâ”€ rate_limit_per_hour
  â”œâ”€ rate_limit_per_day
  â””â”€ price_monthly_cents, is_active

user_subscriptions (FK: user_id, plan_id)
  â”œâ”€ id (PK)
  â”œâ”€ user_id
  â”œâ”€ plan_id
  â”œâ”€ status ('active', 'cancelled', etc)
  â”œâ”€ current_period_start
  â””â”€ current_period_end

api_keys (FK: user_id)
  â”œâ”€ id (PK)
  â”œâ”€ user_id
  â”œâ”€ key_hash (Argon2, nunca texto plano)
  â”œâ”€ last_chars (Ãºltimos 8 caracteres)
  â”œâ”€ rate_limit_plan
  â””â”€ is_active, created_at

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        SEGURIDAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”’ API Keys:
   â”œâ”€ Nunca se guardan en texto plano
   â”œâ”€ Se hashean con Argon2
   â”œâ”€ Se muestran solo UNA VEZ al crear
   â””â”€ No se pueden recuperar despuÃ©s

ğŸ”’ ContraseÃ±as:
   â”œâ”€ Se almacenan en Supabase Auth (no en nuestra BD)
   â””â”€ Se manejan automÃ¡ticamente por Supabase

ğŸ”’ Rate Limiting:
   â”œâ”€ Se almacena en Redis (no persistente)
   â”œâ”€ Ventanas independientes (minuto, hora, dÃ­a)
   â””â”€ Reseteadas automÃ¡ticamente por ventana

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        PRÃ“XIMOS PASOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Leer QUICKREF.md (2 minutos)
2. Leer README.md (10 minutos)
3. Ejecutar: python scripts/main.py test@example.com
4. Verificar en BD que se creÃ³ todo
5. Revisar ARCHITECTURE.md si quieres entender mÃ¡s
6. Modificar ejemplos en examples.py para tu caso de uso

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        PREGUNTAS FRECUENTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P: Â¿DÃ³nde estÃ¡ la API key generada?
R: Se muestra en consola cuando se crea. GuÃ¡rdala, no se puede recuperar.

P: Â¿Puedo ejecutar los mÃ³dulos por separado?
R: SÃ­, cada uno es independiente. Ver examples.py para ejemplos.

P: Â¿QuÃ© pasa si ejecuto el script dos veces con el mismo email?
R: El usuario anterior se elimina y se crea uno nuevo.

P: Â¿CÃ³mo cambio los lÃ­mites de rate limiting?
R: Actualiza la tabla subscription_plans en la BD.

P: Â¿Funciona sin Redis?
R: SÃ­, pero el rate limiting se desactiva (solo advertencia).

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                        SOPORTE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â¿Algo falla? 

1. Revisa TROUBLESHOOTING.md
2. Verifica que .env estÃ¡ configurado
3. AsegÃºrate de que BD estÃ¡ corriendo
4. Revisa que la API FastAPI estÃ¡ activa
5. Mira los logs en consola para pistas

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ¨ TODO LISTO PARA USAR âœ¨

Comienza con: python scripts/main.py test@example.com

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
